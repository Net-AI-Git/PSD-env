# מדריך משתמש - כלי ניתוח PSD

## תוכן עניינים
1. [הקדמה](#הקדמה)
2. [דרישות מערכת](#דרישות-מערכת)
3. [התקנה](#התקנה)
4. [הרצת התוכנה](#הרצת-התוכנה)
5. [ממשק המשתמש - כרטיסיית Optimization](#ממשק-המשתמש---כרטיסיית-optimization)
6. [ממשק המשתמש - כרטיסיית PSD Visualizer](#ממשק-המשתמש---כרטיסיית-psd-visualizer)
7. [פתרון בעיות נפוצות](#פתרון-בעיות-נפוצות)

---

## הקדמה

כלי ניתוח PSD הוא אפליקציית ווב המאפשרת:
- **אופטימיזציה של נתוני PSD** - יצירת מעטפת (envelope) מיטבית מנתוני PSD
- **הצגה ועריכה של נתוני PSD** - צפייה, עריכה ושמירה של גרפים

התוכנה פועלת בדפדפן האינטרנט שלך ומציגה ממשק משתמש נוח ופשוט לשימוש.

---

## דרישות מערכת

- **מערכת הפעלה**: Windows 10 ומעלה
- **Python**: גרסה 3.12
- **דפדפן אינטרנט**: Chrome, Firefox, Edge או כל דפדפן מודרני אחר
- **חיבור לאינטרנט**: נדרש רק בשלב ההתקנה (להורדת חבילות Python)

---

## התקנה

### שיטה 1: התקנה אוטומטית (מומלץ)

1. פתח את תיקיית `install` בתיקיית הפרויקט
2. לחץ פעמיים על הקובץ: **`setup+run(create .venv + install req).bat`**
3. התוכנה תיצור סביבת עבודה וירטואלית, תתקין את כל החבילות הנדרשות ותפתח את הדפדפן אוטומטית

**הערה**: אם הדפדפן לא נפתח אוטומטית, פתח אותו ידנית ונווט לכתובת: `http://localhost:5006/gui`

### שיטה 2: התקנה ידנית

אם ההתקנה האוטומטית לא עובדת, בצע את השלבים הבאים:

1. פתח שורת פקודה (Command Prompt) או PowerShell
2. נווט לתיקיית הפרויקט:
   ```
   cd C:\Users\netanit\Desktop\PSD\main
   ```
3. צור סביבת עבודה וירטואלית:
   ```
   python -m venv .venv
   ```
4. הפעל את הסביבה הווירטואלית:
   ```
   .venv\Scripts\activate
   ```
5. התקן את החבילות הנדרשות:
   ```
   pip install -r requirements.txt
   ```

---

## הרצת התוכנה

### לאחר התקנה ראשונית

1. פתח את תיקיית `install`
2. לחץ פעמיים על הקובץ: **`run_gui.bat`**
3. הדפדפן יפתח אוטומטית עם ממשק התוכנה

**חשוב**: 
- **אל תסגור את חלון הטרמינל** - הוא צריך להישאר פתוח כל זמן שהתוכנה רצה
- כדי לעצור את התוכנה, לחץ `Ctrl+C` בחלון הטרמינל או סגור את החלון

### אם הדפדפן לא נפתח אוטומטית

פתח דפדפן ונווט לכתובת:
```
http://localhost:5006/gui
```

---

## ממשק המשתמש - כרטיסיית Optimization

כרטיסייה זו משמשת להרצת תהליך האופטימיזציה על קבצי PSD.

### שדות קלט

#### Min Frequency (Hz)
- **מה זה**: תדר מינימלי לניתוח (ב-Hz)
- **טווח מותר**: 0 עד 1000
- **ברירת מחדל**: 5
- **איך משתמשים**: הזן את התדר הנמוך ביותר שבו תרצה שהאופטימיזציה תתחיל

#### Max Frequency (Hz)
- **מה זה**: תדר מקסימלי לניתוח (ב-Hz)
- **טווח מותר**: 1 עד 10000
- **ברירת מחדל**: 2000
- **איך משתמשים**: הזן את התדר הגבוה ביותר שבו תרצה שהאופטימיזציה תסתיים
- **הערה**: חייב להיות גדול מ-Min Frequency

#### Target Points
- **מה זה**: מספר הנקודות הרצוי במעטפת הסופית
- **טווח מותר**: 1 עד 200
- **ברירת מחדל**: 45
- **איך משתמשים**: גרור את המחוון או הזן ערך ישירות. זה קובע כמה נקודות יהיו במעטפת האופטימלית

#### Target Area Ratio
- **מה זה**: יחס השטח הרצוי בין המעטפת לנתוני PSD המקוריים
- **טווח מותר**: 0.1 עד 5.0
- **ברירת מחדל**: 1.25
- **איך משתמשים**: 
  - ערך 1.0 = שטח זהה לנתונים המקוריים
  - ערך 1.25 = המעטפת תהיה גדולה ב-25% מהנתונים המקוריים
  - ערך גבוה יותר = מעטפת גדולה יותר (יותר שמרני)

#### Strict Points Constraint
- **מה זה**: תיבת סימון המפעילה אילוץ קפדני על מספר הנקודות
- **ברירת מחדל**: לא מסומן
- **איך משתמשים**: סמן את התיבה אם חשוב לך מאוד שהמעטפת תהיה בדיוק עם מספר הנקודות שצוין ב-Target Points

### כפתורי בחירה (Radio Buttons)

#### Stab Wide
- **מה זה**: בחירת מצב יציבות
- **אפשרויות**:
  - **narrow**: מצב צר - מעטפת הדוקה יותר
  - **wide**: מצב רחב - מעטפת רחבה יותר
- **ברירת מחדל**: narrow
- **איך משתמשים**: לחץ על האפשרות הרצויה

#### Area X-Axis Mode
- **מה זה**: בחירת מצב חישוב השטח
- **אפשרויות**:
  - **Log**: חישוב על בסיס לוגריתמי (מומלץ לרוב המקרים)
  - **Linear**: חישוב על בסיס ליניארי
- **ברירת מחדל**: Log
- **איך משתמשים**: לחץ על האפשרות הרצויה

### תיבות סימון

#### Perform envelope on all files by matching channel names
- **מה זה**: יצירת מעטפת משותפת מכל הקבצים על ידי התאמת שמות ערוצים
- **ברירת מחדל**: לא מסומן
- **איך משתמשים**: 
  - סמן את התיבה אם יש לך מספר קבצים עם ערוצים בעלי שמות דומים (למשל: A1X, A1Y, A1Z) ואתה רוצה מעטפת אחת שתכסה את כולם
  - אם לא מסומן, כל קובץ יעובד בנפרד

### שדה טקסט

#### Input Directory
- **מה זה**: נתיב לתיקיית הקלט
- **ברירת מחדל**: ריק (משתמש בתיקיית `input` של הפרויקט)
- **איך משתמשים**: 
  - השאר ריק כדי להשתמש בתיקיית `input` של הפרויקט
  - או הזן נתיב מלא לתיקייה אחרת המכילה את קבצי ה-PSD שלך (למשל: `C:\Data\PSD_Files`)

### כפתורי פעולה

#### Run Optimization (כפתור ירוק)
- **מה זה**: מתחיל את תהליך האופטימיזציה
- **איך משתמשים**: 
  1. הגדר את כל הפרמטרים הרצויים
  2. לחץ על הכפתור
  3. הכפתור ייעלם ויוחלף בכפתור "Stop Optimization"
- **מה קורה**: התוכנה תעבד את כל הקבצים בתיקיית הקלט ותיצור מעטפות אופטימליות

#### Stop Optimization (כףור אדום)
- **מה זה**: עוצר את תהליך האופטימיזציה
- **מתי מופיע**: רק בזמן שהאופטימיזציה רצה
- **איך משתמשים**: לחץ על הכפתור כדי לעצור את התהליך
- **מה קורה**: התהליך ייעצר, וההגדרות שלך יישמרו

### אזורי מידע

#### Status (אזור סטטוס)
- **מה זה**: מציג את מצב התוכנה הנוכחי
- **צבעים**:
  - **כחול**: מוכן להרצה
  - **כתום**: תהליך רץ או נעצר
  - **ירוק**: הושלם בהצלחה
  - **אדום**: שגיאה
- **דוגמאות הודעות**:
  - "Ready to optimize" - מוכן להרצה
  - "Optimization in progress... Please wait" - תהליך רץ
  - "Optimization completed successfully!" - הושלם
  - "Error: ..." - שגיאה

#### Progress Paragraph (אזור התקדמות)
- **מה זה**: מציג הודעות מפורטות על התקדמות התהליך
- **דוגמאות**:
  - "Starting optimization process..."
  - "Configuring optimization parameters..."
  - "Optimization completed. Check the results directory for output files."

### תוצאות

לאחר שהאופטימיזציה מסתיימת, הקבצים נשמרים בתיקיית `results`:
- **תמונות PNG**: גרפים של המעטפות
- **קבצי טקסט (.spc.txt)**: נתוני המעטפות בפורמט SPC
- **מצגות PowerPoint**: סיכום האופטימיזציה
- **מסמכי Word**: מסמך תמונות

---

## ממשק המשתמש - כרטיסיית PSD Visualizer

כרטיסייה זו משמשת להצגה, עריכה ושמירה של נתוני PSD ומעטפות.

### שדות קלט לתיקיות

#### Source Data Directory
- **מה זה**: נתיב לתיקייה המכילה את קבצי הנתונים המקוריים
- **פורמטים נתמכים**: `.mat` או `.txt`
- **איך משתמשים**: הזן את הנתיב המלא לתיקייה (למשל: `C:\Data\PSD_Files`)
- **דוגמה**: אם הקבצים שלך נמצאים ב-`C:\Data\Source`, הזן: `C:\Data\Source`

#### Envelopes Directory
- **מה זה**: נתיב לתיקייה המכילה את קבצי המעטפות
- **פורמט נדרש**: `.spc.txt`
- **איך משתמשים**: הזן את הנתיב המלא לתיקייה המכילה את קבצי המעטפות
- **דוגמה**: אם המעטפות שלך נמצאות ב-`C:\Data\Envelopes`, הזן: `C:\Data\Envelopes`

### כפתורי פעולה ראשיים

#### Load Data (כפתור כחול)
- **מה זה**: טוען את הנתונים מהתיקיות שצוינו
- **איך משתמשים**: 
  1. הזן את הנתיבים לשני השדות למעלה
  2. לחץ על "Load Data"
- **מה קורה**: התוכנה תחפש התאמות בין קבצי הנתונים המקוריים לקבצי המעטפות (לפי שם) ותטען אותם
- **הערה**: אם לא נמצאו התאמות, תוצג הודעה באזור הסטטוס

#### Save All Changes (כפתור ירוק)
- **מה זה**: שומר את כל השינויים שביצעת
- **מתי פעיל**: רק לאחר שביצעת שינויים (עריכת גרפים או שינוי גורמים)
- **איך משתמשים**: לחץ על הכפתור כדי לשמור
- **מה קורה**: 
  - כל הגרפים המעודכנים יישמרו כתמונות PNG
  - קבצי המעטפות המעודכנים יישמרו בפורמט `.spc.txt`
  - תיווצר מצגת PowerPoint עם כל התמונות
  - תיווצר מסמך Word עם כל התמונות
  - הקבצים יישמרו בתיקייה חדשה עם שם המכיל את השינויים שביצעת

### כפתורי ניווט

#### < Previous (כפתור שמאלי)
- **מה זה**: מעבר לגרף הקודם
- **מתי פעיל**: רק כשיש יותר מגרף אחד, ולא נמצאים בגרף הראשון
- **איך משתמשים**: לחץ כדי לעבור לגרף הקודם ברשימה

#### Next > (כפתור ימני)
- **מה זה**: מעבר לגרף הבא
- **מתי פעיל**: רק כשיש יותר מגרף אחד, ולא נמצאים בגרף האחרון
- **איך משתמשים**: לחץ כדי לעבור לגרף הבא ברשימה

### גורמי התאמה (Factors)

#### Uncertainty Factor
- **מה זה**: גורם אי-ודאות להכפלת המעטפת
- **שני שדות**:
  - **Uncertainty Factor (Ratio)**: ערך מספרי (למשל: 1.1 = הגדלה של 10%)
  - **Uncertainty Factor (dB)**: אותו ערך בדציבלים (למשל: 0.86 dB)
- **איך משתמשים**: 
  - הזן ערך באחד מהשדות - השני יתעדכן אוטומטית
  - הגרף יתעדכן מיד עם השינוי
- **הערה**: השינוי מוחל על כל הגרפים (אלא אם ערכת גרף מסוים ידנית)

#### Safety Factor
- **מה זה**: גורם בטיחות להכפלת המעטפת
- **שני שדות**:
  - **Safety Factor (Ratio)**: ערך מספרי (למשל: 1.2 = הגדלה של 20%)
  - **Safety Factor (dB)**: אותו ערך בדציבלים (למשל: 1.58 dB)
- **איך משתמשים**: 
  - הזן ערך באחד מהשדות - השני יתעדכן אוטומטית
  - הגרף יתעדכן מיד עם השינוי
- **הערה**: השינוי מוחל על כל הגרפים (אלא אם ערכת גרף מסוים ידנית)

#### File Suffix Preview
- **מה זה**: תצוגה מקדימה של הסיומת שתתווסף לשמות הקבצים בעת השמירה
- **איך זה עובד**: 
  - אם שינית את Safety Factor ל-1.2, תראה: `SF1.20`
  - אם שינית את Uncertainty Factor ל-1.1, תראה: `uncertainty1.10`
  - אם שינית את שניהם, תראה: `SF1.20 uncertainty1.10`
- **הערה**: שדה זה לקריאה בלבד - הוא מתעדכן אוטומטית

### אזור הגרף

הגרף מציג:
- **קו כחול**: נתוני PSD המקוריים
- **קו אדום**: המעטפת (SPEC)
- **נקודות אדומות**: נקודות המעטפת (ניתן לערוך)

#### כלי עריכה בגרף

בחלק העליון של הגרף יש 4 כפתורי מצב עריכה:

##### Drag Points (גרירת נקודות)
- **מה זה**: מצב גרירת נקודות קיימות
- **איך משתמשים**: 
  1. לחץ על "Drag Points"
  2. לחץ וגרור נקודה אדומה כדי להזיז אותה
- **מתי להשתמש**: כשאתה רוצה להזיז נקודה קיימת למקום אחר

##### Add Point (הוספת נקודה)
- **מה זה**: מצב הוספת נקודות חדשות
- **איך משתמשים**: 
  1. לחץ על "Add Point"
  2. לחץ על הגרף במקום שבו תרצה להוסיף נקודה חדשה
- **מתי להשתמש**: כשאתה רוצה להוסיף נקודה חדשה למעטפת

##### Delete Point (מחיקת נקודה)
- **מה זה**: מצב מחיקת נקודות
- **איך משתמשים**: 
  1. לחץ על "Delete Point"
  2. לחץ על נקודה אדומה כדי למחוק אותה
- **מתי להשתמש**: כשאתה רוצה להסיר נקודה מהמעטפת

##### Off (כבוי)
- **מה זה**: מצב כבוי - אין עריכה
- **איך משתמשים**: לחץ על "Off" כדי לכבות את כל מצבי העריכה
- **מתי להשתמש**: כשאתה רוצה רק לצפות בגרף ללא עריכה

**הערות חשובות על עריכה**:
- עריכת גרף מסוים **מבטלת** את גורמי ההתאמה (Uncertainty/Safety) עבור אותו גרף
- לאחר עריכה ידנית, שדות גורמי ההתאמה יהפכו לא פעילים עבור הגרף הנוכחי
- ההודעה "(Manual edits active)" תופיע בסטטוס

### אזור סטטוס

- **מה זה**: מציג מידע על המצב הנוכחי
- **דוגמאות הודעות**:
  - "Status: Enter directory paths and click 'Load Data'" - לפני טעינת נתונים
  - "Status: Scanning directories..." - בזמן טעינת נתונים
  - "Displaying 1/5: A1X" - מציג גרף 1 מתוך 5
  - "(Manual edits active)" - עריכה ידנית פעילה
  - "All files saved successfully to ..." - שמירה הושלמה

### מידע בגרף

הגרף מציג בכותרת העליונה:
- **שם הקובץ**: שם הקובץ הנוכחי
- **מספר נקודות**: כמה נקודות יש במעטפת
- **RMS**: ערך RMS של המעטפת (ב-g)
- **RMS Ratio**: היחס בין RMS של המעטפת ל-RMS של הנתונים המקוריים

---

## פתרון בעיות נפוצות

### התוכנה לא נפתחת

**בעיה**: לחיצה על קובץ ה-bat לא עושה כלום

**פתרונות**:
1. ודא ש-Python מותקן: פתח שורת פקודה והקלד `python --version`
2. נסה להריץ את הקובץ `setup+run(create .venv + install req).bat` במקום
3. פתח שורת פקודה ידנית, נווט לתיקיית הפרויקט והרץ:
   ```
   .venv\Scripts\activate
   python -m bokeh serve app\gui.py --show
   ```

### הדפדפן לא נפתח אוטומטית

**פתרון**: פתח דפדפן ונווט לכתובת:
```
http://localhost:5006/gui
```

### שגיאת "Bokeh is not installed"

**פתרון**: הרץ את קובץ ההתקנה:
```
install\setup+run(create .venv + install req).bat
```

### שגיאת "Input directory does not exist"

**פתרון**: 
- ודא שהנתיב שצוין ב-Input Directory קיים
- או השאר את השדה ריק כדי להשתמש בתיקיית `input` של הפרויקט
- ודא שיש קבצים בתיקייה (`.mat` או `.txt`)

### לא נמצאו התאמות ב-Visualizer

**פתרון**: 
- ודא ששמות הקבצים תואמים (למשל: `A1X.mat` ו-`A1X.spc.txt`)
- ודא שהקבצים נמצאים בתיקיות הנכונות
- ודא שהפורמטים נכונים (`.mat` או `.txt` לנתונים, `.spc.txt` למעטפות)

### הכפתור "Save All Changes" לא פעיל

**פתרון**: 
- ודא שביצעת שינויים (עריכת גרף או שינוי גורמים)
- לחץ על "Load Data" קודם אם עדיין לא טענת נתונים

### האופטימיזציה לוקחת זמן רב

**זה נורמלי**: תהליך האופטימיזציה יכול לקחת זמן, במיוחד עם קבצים גדולים או מספר רב של קבצים. בדוק את אזור ההתקדמות כדי לראות את הסטטוס.

---

## סיכום

### תהליך עבודה מומלץ - Optimization

1. הכנס קבצי PSD לתיקיית `input` (או ציין תיקייה אחרת)
2. פתח את התוכנה
3. עבור לכרטיסיית "Optimization"
4. הגדר את הפרמטרים הרצויים:
   - תדרים מינימלי ומקסימלי
   - מספר נקודות יעד
   - יחס שטח יעד
   - מצבי יציבות וחישוב שטח
5. לחץ על "Run Optimization"
6. המתן לסיום התהליך
7. בדוק את התוצאות בתיקיית `results`

### תהליך עבודה מומלץ - Visualizer

1. פתח את התוכנה
2. עבור לכרטיסיית "PSD Visualizer"
3. הזן נתיבים לתיקיות הנתונים והמעטפות
4. לחץ על "Load Data"
5. עיין בגרפים באמצעות כפתורי Previous/Next
6. בצע שינויים אם נדרש:
   - שנה גורמי התאמה (Uncertainty/Safety)
   - או ערוך גרפים ידנית (גרור, הוסף, מחק נקודות)
7. לחץ על "Save All Changes" כדי לשמור

---

**בהצלחה!**

אם נתקלת בבעיות נוספות או יש לך שאלות, פנה למפתח התוכנה.

